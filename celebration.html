<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Surprise!</title>
<style>
    body {
        margin: 0;
        background: black;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }
    canvas {
        display: block;
    }
    .message {
        position: absolute;
        color: white;
        font-size: clamp(28px, 6vw, 70px);
        font-weight: bold;
        text-align: center;
        opacity: 0;
        transition: opacity 1.5s ease-in;
        text-shadow: 0 0 15px red, 0 0 30px pink;
    }
</style>
</head>
<body>
<canvas id="scene"></canvas>
<div class="message" id="msg">❤️ Happy Birthday ❤️</div>

<script>
const canvas = document.getElementById("scene");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let heartHit = false;
let crackProgress = 0;
let halvesSeparated = false;
let arrowX = -100;
let arrowY = canvas.height / 2;
let halfOffset = 0;
let arrowStuck = false;

// Draw a realistic heart
function drawHeart(x, y, size, color, offsetX = 0) {
    ctx.save();
    ctx.translate(x + offsetX, y);
    ctx.beginPath();
    ctx.moveTo(0, size / 4);
    ctx.bezierCurveTo(size / 2, -size / 2, size * 1.5, size / 3, 0, size);
    ctx.bezierCurveTo(-size * 1.5, size / 3, -size / 2, -size / 2, 0, size / 4);
    ctx.closePath();
    ctx.shadowColor = "red";
    ctx.shadowBlur = 30;
    ctx.fillStyle = color;
    ctx.fill();
    ctx.restore();
}

// Draw arrow
function drawArrow(x, y) {
    ctx.save();
    ctx.translate(x, y);
    ctx.fillStyle = "gold";
    ctx.fillRect(0, -2, 60, 4); // shaft
    ctx.beginPath();
    ctx.moveTo(60, 0);
    ctx.lineTo(70, -5);
    ctx.lineTo(70, 5);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
}

// Zig-zag crack drawing
function drawCrack(x, y, size, progress) {
    const crackHeight = size * 1.2;
    const steps = 6;
    ctx.strokeStyle = "white";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(x, y); // start at arrow tip
    for (let i = 1; i <= steps; i++) {
        let px = x + (i % 2 === 0 ? 5 : -5);
        let py = y + (i / steps) * crackHeight * progress;
        ctx.lineTo(px, py);
    }
    ctx.stroke();
}

// Fireworks system
const fireworks = [];
function random(min, max) {
    return Math.random() * (max - min) + min;
}
function Firework(x, y) {
    this.particles = [];
    for (let i = 0; i < 50; i++) {
        this.particles.push({
            x, y,
            speed: random(2, 5),
            angle: random(0, Math.PI * 2),
            alpha: 1,
            decay: random(0.01, 0.02),
            color: `hsl(${random(0, 360)}, 100%, 50%)`
        });
    }
}
Firework.prototype.update = function() {
    this.particles.forEach(p => {
        p.x += Math.cos(p.angle) * p.speed;
        p.y += Math.sin(p.angle) * p.speed;
        p.alpha -= p.decay;
    });
};
Firework.prototype.draw = function() {
    this.particles.forEach(p => {
        ctx.globalAlpha = p.alpha;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
        ctx.fill();
    });
    ctx.globalAlpha = 1;
};

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const heartX = canvas.width / 2;
    const heartY = canvas.height / 2;
    const heartSize = 150;

    // Draw heart(s)
    if (!halvesSeparated) {
        drawHeart(heartX, heartY, heartSize, "red");
    } else {
        drawHeart(heartX, heartY, heartSize, "red", -halfOffset);
        drawHeart(heartX, heartY, heartSize, "red", halfOffset);
    }

    // Arrow movement
    if (!heartHit) {
        arrowX += 8;
        drawArrow(arrowX, arrowY);
        if (arrowX > heartX - heartSize / 2) {
            heartHit = true;
            arrowStuck = true;
            setTimeout(() => {
                startCrack = true;
            }, 500); // small pause before crack starts
        }
    } else if (arrowStuck && !halvesSeparated) {
        drawArrow(heartX - heartSize / 2, arrowY);
    }

    // Crack animation
    if (heartHit && crackProgress < 1 && !halvesSeparated) {
        crackProgress += 0.02;
        drawCrack(heartX, heartY, heartSize, crackProgress);

        if (crackProgress >= 1) {
            setTimeout(() => {
                halvesSeparated = true;
                document.getElementById("msg").style.opacity = 1;
                fireworks.push(new Firework(heartX, heartY));
            }, 300);
        }
    }

    // Halves separate + fireworks
    if (halvesSeparated) {
        halfOffset += 1.5;
        if (Math.random() < 0.1) {
            fireworks.push(new Firework(random(0, canvas.width), random(0, canvas.height / 2)));
        }
    }

    // Fireworks update/draw
    fireworks.forEach((f, i) => {
        f.update();
        f.draw();
        if (f.particles[0].alpha <= 0) fireworks.splice(i, 1);
    });

    requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
